var calendar = [];
var current = [];
var next = [];

Graphics.prototype.setFontRighteousRegular = function() {
  // Actual height 53 (56 - 4)
  return this.setFontCustom(
    E.toString(require('heatshrink').decompress(atob('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'))),
    46,
    atob("EiItFigpLCkrJCsrEw=="),
    70|65536
  );
}


Graphics.prototype.setFontcontainyourselffs = function() {
  // Actual height 62 (108 - 47)
  return this.setFontCustom(
    E.toString(require('heatshrink').decompress(atob('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'))),
    46,
    36,
    123|65536
  );
}

Graphics.prototype.setFontLECO1976Regular22 = function(scale) {
  // Actual height 22 (21 - 0)
  g.setFontCustom(atob("AAAAAAAAAAAAAAAAAAAAAAAAAAAAAP/nA/+cD/5wP/nAAAAAAAAPwAA/gAD+AAPwAAAAAD+AAP4AA/gAAAAAAAAAAAAAcOAP//A//8D//wP//AHDgAcOAP//A//8D//wP//AHDgAAAAAAAAH/jgf+OB/44H/jj8OP/w4//Dj/8OPxw/4HD/gcP+Bw/4AAAAAAAP+AA/8AD/wQOHHA4c8D//wP/8A//gAD4AAfAAH/8A//wP//A84cDjhwIP/AA/8AB/wAAAAAAAD//wP//A//8D//wOHHA4ccDhxwOHHA4f8Dh/wOH/A4f8ABwAAAAAAAAD8AAP4AA/gAD8AAAAAAAAAAAEAAD+AB//A///v/D//gB/wABwAAAAAADgAA/wAf/4P8///wf/4AP8AAOAAAAAAAAAyAAHcAAPwAD/gAP/AA/8AA/AAH8AAMwAAAAAAAAAAAAADgAAOAAA4AAf8AD/wAP/AA/8AAOAAA4AADgAAAAAAAAAAD8AAfwAB/AAD8AAAAAAAADgAAOAAA4AADgAAOAAA4AADgAAAAAAAAAADgAAOAAA4AADgAAAAAAAAABwAB/AA/8A//gP/gA/wADwAAIAAAAAAD//wP//A//8D//wOAHA4AcDgBwOAHA//8D//wP//A//8AAAAAAAA4AcDgBwOAHA//8D//wP//A//8AABwAAHAAAcAAAAAAAA+f8D5/wPn/A+f8DhxwOHHA4ccDhxwP/HA/8cD/xwP/HAAAAAAAAOAHA4AcDhxwOHHA4ccDhxwOHHA4ccD//wP//A//8D//wAAAAAAAD/wAP/AA/8AD/wAAHAAAcAABwAAHAA//8D//wP//A//8AAAAAAAA/98D/3wP/fA/98DhxwOHHA4ccDhxwOH/A4f8Dh/wOH/AAAAAAAAP//A//8D//wP//A4ccDhxwOHHA4ccDh/wOH/A4f8Dh/wAAAAAAAD4AAPgAA+AADgAAOAAA4AADgAAP//A//8D//wP//AAAAAAAAP//A//8D//wP//A4ccDhxwOHHA4ccD//wP//A//8D//wAAAAAAAD/xwP/HA/8cD/xwOHHA4ccDhxwOHHA//8D//wP//A//8AAAAAAAAOA4A4DgDgOAOA4AAAAAAAAOA/A4H8DgfwOA/AAAAAAAAB4AAPwAA/AAD8AAf4ABzgAPPAA8cAHh4AAAAAAAAAAAAHHAAccABxwAHHAAccABxwAHHAAccABxwAHHAAAAAAAAAOHAA4cADzwAPPAAf4AB/gAD8AAPwAAeAAB4AAAAAAAAA+AAD4AAPgAA+ecDh9wOH3A4fcDhwAP/AA/8AD/wAP/AAAAAAAAAP//4///j//+P//44ADjn/OOf845/zjnHOP8c4//zj//OP/84AAAAAAAP//A//8D//wP//A4cADhwAOHAA4cAD//wP//A//8D//wAAAAAAAD//wP//A//8D//wOHHA4ccDhxwOHHA//8D//wP9/A/j8AAAAAAAA//8D//wP//A//8DgBwOAHA4AcDgBwOAHA4AcDgBwOAHAAAAAAAAP//A//8D//wP//A4AcDgBwOAHA8A8D//wH/+AP/wAf+AAAAAAAAD//wP//A//8D//wOHHA4ccDhxwOHHA4ccDhxwOAHA4AcAAAAAAAA//8D//wP//A//8DhwAOHAA4cADhwAOHAA4cADgAAOAAAAAAD//wP//A//8D//wOAHA4ccDhxwOHHA4f8Dh/wOH/A4f8AAAAAAAA//8D//wP//A//8ABwAAHAAAcAABwAP//A//8D//wP//AAAAAAAAP//A//8D//wP//AAAAAAAAOAHA4AcDgBwOAHA4AcDgBwOAHA//8D//wP//A//8AAAAAAAA//8D//wP//A//8AHwAA/AAP8AB/wAPn/A8f8DB/wIH/AAAAAAAAP//A//8D//wP//AAAcAABwAAHAAAcAABwAAHAAAAAAAAP//A//8D//wP//Af8AAP+AAH/AAD8AAHwAD/AB/wAf8AP+AA//8D//wP//AAAAAAAAP//A//8D//wP//AfwAAfwAAfwAAfwAAfwP//A//8D//wAAAAAAAAAAAP//A//8D//wP//A4AcDgBwOAHA4AcD//wP//A//8D//wAAAAAAAD//wP//A//8D//wOHAA4cADhwAOHAA/8AD/wAP/AA/8AAAAAP//A//8D//wP//A4AcDgBwOAHA4AcD//+P//4///j//+AAA4AADgAAAP//A//8D//wP//A4eADh+AOH8A4f4D/3wP/HA/8MD/wQAAAAAAAD/xwP/HA/8cD/xwOHHA4ccDhxwOHHA4f8Dh/wOH/A4f8AAAAAAAA4AADgAAOAAA//8D//wP//A//8DgAAOAAA4AADgAAAAAA//8D//wP//A//8AABwAAHAAAcAABwP//A//8D//wP//AAAADAAAPgAA/wAD/4AB/8AA/8AAfwAB/AA/8Af+AP/AA/wAD4AAMAAA4AAD+AAP/gA//8AH/wAB/AAf8Af/wP/4A/4AD/gAP/4AH/8AB/wAB/AB/8D//wP/gA/gADgAAIABA4AcDwDwPw/Afn4Af+AA/wAD/AA//AH5+A/D8DwDwOAHAgAEAAAAP/AA/8AD/wAP/AAAf8AB/wAH/AAf8D/wAP/AA/8AD/wAAAAAAAADh/wOH/A4f8Dh/wOHHA4ccDhxwOHHA/8cD/xwP/HA/8cAAAAAAAAf//9///3///f//9wAA3AADcAAMAAAOAAA/gAD/wAH/8AB/8AA/wAAPAAAEAAAAHAADcAANwAB3///f//9///wAA"), 32, atob("BwYLDg4UDwYJCQwMBgkGCQ4MDg4ODg4NDg4GBgwMDA4PDg4ODg4NDg4GDQ4MEg8ODQ8ODgwODhQODg4ICQg="), 22+(scale<<8)+(1<<16));
};


const SETTINGS_FILE = "pebble.json";
let settings;
let theme;
let drawTimeout;

let loadSettings = function() {
  settings = require("Storage").readJSON(SETTINGS_FILE,1)|| {'bg': '#0f0', 'color': 'Green', 'theme':'System', 'showlock':false};
};

const img = require("heatshrink").decompress(atob("oFAwkEogA/AH4A/AH4A/AH4A/AE8AAAoeXoAfeDQUBmcyD7A+Dh///8QD649CiAfaHwUvD4sEHy0DDYIfEICg+Cn4fHICY+DD4nxcgojOHwgfEIAYfRCIQaDD4ZAFD5r7DH4//kAfRCIZ/GAAnwD5p9DX44fTHgYSBf4ofVDAQEBl4fFUAgfOXoQzBgIfFBAIfPP4RAEAoYAB+cRiK/SG4h/WIBAfXIA7CBAAswD55AHn6fUIBMCD65AHl4gCmcziAfQQJqfQQJpiDgk0IDXxQLRAEECaBM+QgRYRYgUIA0CD4ggSQJiDCiAKBICszAAswD55AHABKBVD7BAFABIqBD5pAFABPxD55AOD6BADiIAJQAyxLABwf/gaAPAH4A/AH4ARA=="));
const t = 2;
const h = g.getHeight();
const w = g.getWidth();
const shift_up = 20;
const ha = 2*h/5 - shift_up;
const h2 = 3*h/5 - 11 - shift_up;
const h3 = 7*h/8 - shift_up;

let batteryWarning = false;
function isActive(event) {
  var timeActive = getTime() - event.timestamp;
  if (event.allDay) {
    return false;
  }
  return timeActive >= 0 && timeActive <= event.durationInSeconds;
}

const weather = require('weather');

function buzzForEvents() {
  calendar = require("Storage").readJSON("android.calendar.json",true)||[];
  calendar = calendar.filter(e => isActive(e) || getTime() <= e.timestamp);
  calendar.sort((a,b) => a.timestamp - b.timestamp);

  current = calendar.filter(isActive);
  next = calendar.filter(e=>!isActive(e));

  let nextEvent = next[0]; if (!nextEvent) return null;
  let minToEvent = Math.round((nextEvent.timestamp - getTime()) / 60.0);
  switch (minToEvent) {
    case 5: Bangle.buzz(2000, .4);Bangle.buzz(1000, .7); break;
    case 1: Bangle.buzz(1000, 1); Bangle.buzz(500, .5); break;
  }
  if (minToEvent <= 5) {
    return nextEvent.title;
  } else {
    return null;
  }
}

const locale = require("locale");

let draw = function() {
  // queue next draw
  if (drawTimeout) clearTimeout(drawTimeout);
  drawTimeout = setTimeout(function() {
    drawTimeout = undefined;
    draw();
  }, 60000 - (Date.now() % 60000));

  let date = new Date();
  let dayOfWeek = locale.dow(date, 1).toUpperCase();
  let dayOfMonth = date.getDate();
  let month = locale.month(date, 1).toUpperCase();
  let time = locale.time(date, 1);
  let steps = Bangle.getHealthStatus("day").steps;



  g.reset();

  var eventTitle = buzzForEvents();
  g.setColor(settings.bg);
  g.fillRect(0, 0, w, h2 - t);

  // contrast bar
  g.setColor(theme.fg);
  g.fillRect(0, h2 - t, w, h2);

  // day and steps
  g.setColor(theme.day);
  g.setFontLECO1976Regular22();
  g.setFontAlign(0, -1);
  g.drawString(dayOfWeek, w/4 - 20, ha);
  g.drawString(steps, w/2 + 8, ha);
  g.drawString(E.getBattery(), 3*w/4 + 15, ha);

  g.setFontAlign(1, -1, 90);
  g.drawString(month, 45, 7)
  // time
  // white on red for battery warning
  g.setColor(settings.bg);
  g.fillRect(0, h2, w, h3);

  g.setFontcontainyourselffs();
  g.setFontAlign(0, -1);
  g.setColor(theme.bg);
  g.drawString(time, w/2, h2 - 51);

  // contrast bar
  g.setColor(theme.fg);
  g.fillRect(0, h3, w, h3 + t);
  // the bottom
  g.setColor(settings.bg);
  g.fillRect(0, h3 + t, w, h);


  g.setColor(settings.bg);
  drawCalendar(5, 7, 38, 4, dayOfMonth);
  g.drawImage(img, w/2 - 16 , 1, { scale: 0.8 });
  drawBattery(w-48, 14, 38, 17);

  g.setFontAlign(-1,-1).setFont("Vector",20);
  //g.setFontAlign(-1,-1);
  //g.setFontLECO1976Regular22();
  g.setColor(theme.day);
  let current = weather.get();
  console.log(current.stringify);
  if (eventTitle !== null) {
    g.drawString(g.wrapString(eventTitle, w-8).join("\n"), 4, h3+t);
  } else {
    const temp = locale.temp(current.temp-273.15).match(/^(\D*\d*)(.*)$/);
    g.drawString(temp[1]+temp[2], 4, h3+t);
  }

  drawLock();
};

// at x,y width:wi thicknes:th
let drawCalendar = function(x,y,wi,th,str) {
  g.setColor(theme.fg);
  g.fillRect(x, y, x + wi, y + wi);
  g.setColor(theme.bg);
  g.fillRect(x + th, y + th, x + wi - th, y + wi - th);
  g.setColor(theme.fg);

  let hook_t = 6;
  // first calendar hook, one third in
  g.fillRect(x + (wi/3) - (th/2), y - hook_t, x + wi/3 + th - (th/2), y + hook_t);
  // second calendar hook, two thirds in
  g.fillRect(x + (2*wi/3) -(th/2), y - hook_t, x + 2*wi/3 + th - (th/2), y + hook_t);

  g.setFontLECO1976Regular22();
  g.setFontAlign(0, 0);
  g.drawString(str, x + wi/2, y + wi/2 + th);
};

let loadThemeColors = function() {
  theme = {fg: g.theme.fg, bg: g.theme.bg, day: g.toColor(0,0,0)};
  if (settings.theme === "Dark") {
    theme.fg = g.toColor(1,1,1);
    theme.bg = g.toColor(0,0,0);
  } else if (settings.theme === "Light") {
    theme.fg = g.toColor(0,0,0);
    theme.bg = g.toColor(1,1,1);
  }
  // day and steps
  if (settings.color == 'Blue' || settings.color == 'Red')
    theme.day = g.toColor(1,1,1); // white on blue or red best contrast
};

let drawBattery=function(x,y,wi,hi) {
  g.reset();
  g.setColor(g.theme.fg);
  g.fillRect(x,y+2,x+wi-4,y+2+hi); // outer
  g.clearRect(x+2,y+2+2,x+wi-4-2,y+2+hi-2); // centre
  g.setColor(g.theme.fg);
  g.fillRect(x+wi-3,y+2+(((hi - 1)/2)-1),x+wi-2,y+2+(((hi - 1)/2)-1)+4); // contact
  g.fillRect(x+3, y+5, x +3 + E.getBattery()*(wi-10)/100, y+hi-1); // the level

  if( Bangle.isCharging() )
  {
    g.setBgColor(settings.bg);
    const image = require("heatshrink").decompress(atob("j8OwMB/4AD94DC44DCwP//n/gH//EOgE/+AdBh/gAYMH4EAvkDAYP/+/AFAX+FgfzGAnAA=="));
    g.drawImage(image,x+3,y+4);
  }

}

let drawLock = function(){
  if (settings.showlock) {
    if (Bangle.isLocked()){
      g.setColor(theme.day);
      g.setBgColor(settings.bg);
      g.drawImage(atob("DhABH+D/wwMMDDAwwMf/v//4f+H/h/8//P/z///f/g=="), 1, 4);
    } else {
      g.setColor(settings.bg);
      g.fillRect(0, 0, 20, 20);
    }
  }
};

Bangle.on('lock', drawLock);

// Show launcher when middle button pressed
Bangle.setUI({
  mode : "clock",
  remove : function() {
    // Called to unload all of the clock app
    Bangle.removeListener('lock', drawLock);
    if (drawTimeout) clearTimeout(drawTimeout);
    drawTimeout = undefined;
    delete Graphics.prototype.setFontLECO1976Regular22;
    delete Graphics.prototype.setFontRighteousRegular;
    require("widget_utils").show(); // re-show widgets
  }});

g.clear();
Bangle.loadWidgets();
require("widget_utils").swipeOn(); // hide widgets, make them visible with a swipe

loadSettings();
loadThemeColors();
draw();
